<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script
  src="https://cdn.utmify.com.br/scripts/utms/latest.js"
  data-utmify-prevent-xcod-sck
  data-utmify-prevent-subids
  async
  defer
></script>
<script>
  window.googlePixelId = "682f30ea1e7e46c2d68c5582";
  var a = document.createElement("script");
  a.setAttribute("async", "");
  a.setAttribute("defer", "");
  a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel-google.js");
  document.head.appendChild(a);
</script>
  <meta charset="UTF-8">
  <title>Redirecionando...</title>
  <script>
    const upsellPages = [
      "https://web-production-615f4.up.railway.app/pos/upsell/01/index.html",
      "https://web-production-615f4.up.railway.app/pos/upsell/02/index.html",
      "https://web-production-615f4.up.railway.app/pos/upsell/03/index.html",
      "https://web-production-615f4.up.railway.app/pos/upsell/04/index.html",
      "https://web-production-615f4.up.railway.app/pos/upsell/05/index.html",
      "https://web-production-615f4.up.railway.app/pos/upsell/06/index.html"
    ];

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parseInt(parts.pop().split(';').shift());
      return null;
    }

    function setCookie(name, value, days) {
      const expires = new Date(Date.now() + days * 864e5).toUTCString();
      document.cookie = `${name}=${value}; expires=${expires}; path=/`;
    }

    window.onload = function () {
      let step = getCookie("upsell_progress");

      if (step === null || isNaN(step)) {
        step = 0;
      } else {
        step += 1;
      }

      if (step >= upsellPages.length) {
        window.location.href = "https://hv-consultar.shop/pos";
        return;
      }

      setCookie("upsell_progress", step, 30);
      window.location.href = upsellPages[step];
    }
  </script>
</head>
<body>
  <p style="display: none;">Redirecionando...</p>

<script>
(function() {
    function updateAllLinksAndForms() {
        const urlParams = new URLSearchParams(window.location.search);
        const utms = {};
        urlParams.forEach((value, key) => {
            if (key.startsWith('utm_') || key === 'cpf' || key === 'fbclid' || key === 'gclid') {
                utms[key] = value;
            }
        });

        if (Object.keys(utms).length === 0) return;

        document.querySelectorAll('a').forEach(link => {
            try {
                const href = link.getAttribute('href');
                if (!href || href.startsWith('#') || href.startsWith('javascript:')) return;
                
                let url;
                try {
                    url = new URL(href, window.location.origin);
                } catch(e) {
                    const separator = href.includes('?') ? '&' : '?';
                    const linkParams = new URLSearchParams();
                    Object.keys(utms).forEach(key => linkParams.set(key, utms[key]));
                    link.href = href + separator + linkParams.toString();
                    return;
                }

                if (url.origin === window.location.origin || href.startsWith('.') || href.startsWith('/')) {
                    const linkParams = new URLSearchParams(url.search);
                    Object.keys(utms).forEach(key => linkParams.set(key, utms[key]));
                    url.search = linkParams.toString();
                    link.href = url.toString();
                }
            } catch (e) {}
        });

        document.querySelectorAll('form').forEach(form => {
            Object.keys(utms).forEach(key => {
                let input = form.querySelector(`input[name="${key}"]`);
                if (!input) {
                    input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    form.appendChild(input);
                }
                input.value = utms[key];
            });
        });
    }

    updateAllLinksAndForms();
    window.addEventListener('load', updateAllLinksAndForms);
    document.addEventListener('DOMContentLoaded', updateAllLinksAndForms);
    const observer = new MutationObserver(updateAllLinksAndForms);
    observer.observe(document.documentElement, { childList: true, subtree: true });
})();
</script>

</body>
</html>