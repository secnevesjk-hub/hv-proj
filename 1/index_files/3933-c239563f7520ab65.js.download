"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3933],{25535:function(t,e,a){a.d(e,{Ho:function(){return w},aC:function(){return f}});var r=a(2265);let n=(0,r.createContext)({});var o=a(99955),i=a(70804),u=a(5707),c=a(66885),s=a(15050);function l(t){return(0,o.C)((0,i._)((0,u.K)(t),1))}let _=[c.c.Com_Cartao_Inativo_Fatura_Aberta_Com_Senha_Digital,c.c.Com_Cartao_Com_Senha_Digital,c.c.Sem_Cartao_Com_Senha_Digital],C=[c.c.Com_Cartao_Inativo_Fatura_Aberta_Sem_Senha_Digital,c.c.Com_Cartao_Sem_Senha_Digital],m=[c.c.Com_Cartao_Inativo_Bloqueado,c.c.Com_Cartao_Inativo_Fatura_Aberta_Com_Senha_Digital,c.c.Com_Cartao_Inativo_Fatura_Aberta_Sem_Senha_Digital,c.c.Com_Cartao_Sem_Senha_Digital,c.c.Com_Cartao_Com_Senha_Digital];function f(){return(0,r.useContext)(n)}var d=a(57437),h=a(14474),S=a(76533),g=a(43577),p=a(29827),v=a(99376),I=a(57385),E=a(17610),b=a(91923),A={cpfAuthentication:t=>b.f0.post("/autenticacao/api/v2/sem-senha",t),authenticate:t=>b.x3.post("/agregador/api/v2/autenticacao/login",t,{headers:{"X-API-KEY":"oX0}nMmgit+b[b8J*crf"}}),refreshToken:t=>b.x9.post("/agregador/api/v2/autenticacao/refresh-token",t)};let D=(0,S.J)(1),k={user:void 0,isAuthenticated:void 0};function w(t){let{children:e}=t,[a,o]=(0,r.useState)(k),[i,u]=(0,r.useState)({}),f=(0,p.NL)(),S=(0,v.useRouter)(),b=(0,v.usePathname)(),w=(0,r.useCallback)(()=>{f.clear(),(0,E.Z)(),o(k)},[f,o]),R=(0,r.useCallback)(()=>{w(),S.push("/")},[w,S]),y=(0,r.useCallback)(async()=>{let t=localStorage.getItem(I.m.REFRESH_TOKEN);if(t)try{let e=await A.refreshToken({refreshToken:t});if(e.status===g.WE.Ok){let{accessToken:t,refreshToken:a}=e.data.result;localStorage.setItem(I.m.ACCESS_TOKEN,t),localStorage.setItem(I.m.REFRESH_TOKEN,a)}}catch(t){w()}},[w]);(0,r.useEffect)(()=>{let t=setInterval(async()=>{let t=localStorage.getItem(I.m.ACCESS_TOKEN);if(t){let{exp:e}=(0,h.o)(t);e&&l(e)&&y()}},D);return()=>clearInterval(t)},[w,y]),(0,r.useEffect)(()=>{let t=localStorage.getItem(I.m.USER);if(t){let e=JSON.parse(t),a=localStorage.getItem(I.m.ACCESS_TOKEN),r=!1;if(a){let{exp:t}=(0,h.o)(a);!t||(r=!l(t))||y()}o({user:e,isAuthenticated:r})}else w()},[w,y]);let N=(0,r.useCallback)(async(t,e)=>{let{username:a,password:r,callback:n}=t;try{return await A.authenticate({usuario:a,senha:r,tipoAutenticacao:0}).then(t=>{let{accessToken:a,refreshToken:r}=t.data.result;return o(t=>({...t,isAuthenticated:!0})),localStorage.setItem(I.m.ACCESS_TOKEN,a),localStorage.setItem(I.m.REFRESH_TOKEN,r),n&&n(),e&&S.push(e),{isSuccess:!0,errors:[]}})}catch(e){var i;let{response:t}=e;return{isSuccess:!1,errors:null!==(i=null==t?void 0:t.data.errors)&&void 0!==i?i:[]}}},[S]),F=(0,r.useCallback)(async(t,e,a)=>((0,E.Z)(),await A.cpfAuthentication({cpf:t}).then(r=>{let{nome:n,situacaoCliente:i,token:l}=r.data.result,{hasCard:f,...d}=function(t){let e=_.includes(t);return{digitalPasswordAction:C.includes(t)?s.X.Create:s.X.Reset,hasDigitalPassword:e,hasRestrictions:t===c.c.Com_Restricao,hasCard:m.includes(t)}}(i),h={id:t,name:n,status:i,hasCard:f};return(localStorage.setItem(I.m.SIMPLIFIED_ACCESS_TOKEN,l),localStorage.setItem(I.m.USER,JSON.stringify(h)),o({user:h}),u(d),i===c.c.Inexistente)?(b.includes("/criar-conta")||S.push("/criar-conta"),{isSuccess:!1,errors:["Usu\xe1rio n\xe3o encontrado"]}):(d.hasDigitalPassword||a?e&&S.push(e):S.push("/aviso-criar-senha-digital"),{isSuccess:!0,errors:[]})}).catch(t=>{if(t.response){t.response.status===g.WE.Forbidden&&u(t=>({...t,found:!1}));let e=[];return t.response.status===g.WE.BadRequest&&e.push("CPF inv\xe1lido, verifique a digita\xe7\xe3o"),t.response.status>=g.WE.InternalServerError&&e.push("Ocorreu um erro ao realizar login"),{isSuccess:!1,errors:e}}return{isSuccess:!1,errors:[]}})),[S]),O=(0,r.useMemo)(()=>({attempt:N,auth:a,logout:R,login:i,setLogin:u,simplifiedLogin:F}),[N,a,i,R,F]);return(0,d.jsx)(n.Provider,{value:O,children:e})}},66885:function(t,e,a){var r,n;a.d(e,{c:function(){return r}}),(n=r||(r={}))[n.Inexistente=0]="Inexistente",n[n.Com_Cartao_Inativo_Bloqueado=1]="Com_Cartao_Inativo_Bloqueado",n[n.Com_Cartao_Inativo_Fatura_Aberta_Com_Senha_Digital=2]="Com_Cartao_Inativo_Fatura_Aberta_Com_Senha_Digital",n[n.Com_Cartao_Inativo_Fatura_Aberta_Sem_Senha_Digital=3]="Com_Cartao_Inativo_Fatura_Aberta_Sem_Senha_Digital",n[n.Com_Cartao_Sem_Senha_Digital=4]="Com_Cartao_Sem_Senha_Digital",n[n.Com_Cartao_Com_Senha_Digital=5]="Com_Cartao_Com_Senha_Digital",n[n.Com_Restricao=6]="Com_Restricao",n[n.Sem_Cartao_Com_Senha_Digital=7]="Sem_Cartao_Com_Senha_Digital"},15050:function(t,e,a){var r,n;a.d(e,{X:function(){return r}}),(n=r||(r={}))[n.Create=0]="Create",n[n.Reset=1]="Reset"},64193:function(t,e,a){a.d(e,{w:function(){return r}});function r(t){return t.replaceAll(/[^\d]/g,"").replace(/^(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2")}},39967:function(t,e,a){a.d(e,{s:function(){return u}});let r=/^(\d)\1{10}$/,n=/(\.)|(\-)/g;function o(t){let e=10*t%11;return 10===e||11===e?0:e}function i(t){let e=t.length+1;return t.reduce((t,a,r)=>t+a*(e-r),0)}function u(t){if(t.length<14)return!1;let e=t.replaceAll(n,"");if(e.match(r))return!1;let a=e.split("").map(t=>parseInt(t,10));return o(i(a.slice(0,9)))===a[9]&&o(i(a.slice(0,10)))===a[10]}},29827:function(t,e,a){a.d(e,{NL:function(){return i},aH:function(){return u}});var r=a(2265),n=a(57437),o=r.createContext(void 0),i=t=>{let e=r.useContext(o);if(t)return t;if(!e)throw Error("No QueryClient set, use QueryClientProvider to set one");return e},u=t=>{let{client:e,children:a}=t;return r.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),(0,n.jsx)(o.Provider,{value:e,children:a})}},5707:function(t,e,a){a.d(e,{K:function(){return n}});var r=a(99649);function n(t){return(0,r.Q)(1e3*t)}},99955:function(t,e,a){a.d(e,{C:function(){return n}});var r=a(99649);function n(t){return+(0,r.Q)(t)<Date.now()}},76533:function(t,e,a){a.d(e,{J:function(){return n}});var r=a(78198);function n(t){return Math.trunc(t*r.yJ)}},70804:function(t,e,a){a.d(e,{_:function(){return i}});var r=a(99649),n=a(63497),o=a(78198);function i(t,e){return function(t,e){let a=+(0,r.Q)(t);return(0,n.L)(t,a+e)}(t,-e*o.yJ)}},14474:function(t,e,a){a.d(e,{o:function(){return n}});class r extends Error{}function n(t,e){let a;if("string"!=typeof t)throw new r("Invalid token specified: must be a string");e||(e={});let n=!0===e.header?0:1,o=t.split(".")[n];if("string"!=typeof o)throw new r(`Invalid token specified: missing part #${n+1}`);try{a=function(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw Error("base64 string is not of the correct length")}try{var a;return a=e,decodeURIComponent(atob(a).replace(/(.)/g,(t,e)=>{let a=e.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}catch(t){return atob(e)}}(o)}catch(t){throw new r(`Invalid token specified: invalid base64 for part #${n+1} (${t.message})`)}try{return JSON.parse(a)}catch(t){throw new r(`Invalid token specified: invalid json for part #${n+1} (${t.message})`)}}r.prototype.name="InvalidTokenError"}}]);